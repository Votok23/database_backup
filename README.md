# Домашнее задание к занятию "Резервное копирование баз данных" - Котов Г.И.




### Задание 1. Резервное копирование
Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Приведите ответ в свободной форме.


### Решение 1: 
1.1. Восстановление за предыдущий день
- Подходит ежедневное полное резервное копирование.

- Плюсы: Простота восстановления (нужна одна копия), предсказуемость

- Минусы: Высокая нагрузка на систему, большой объем хранилища

1.2. Восстановление за час до поломки
Требуется комбинированный подход:

- Полное копирование (раз в сутки)

- Дифференциальное копирование (каждые 4-6 часов)

- Копирование журналов транзакций (каждые 15-30 минут)

Восстановление: полная копия → последняя дифференциальная → журналы транзакций до нужного момента.

1.3. Моментальное переключение при поломке
Да, возможно через системы репликации:

- Настройка основной и резервной БД с постоянной синхронизацией

- Автоматическое переключение при сбое основной базы

- Технологии: PostgreSQL Streaming Replication, MySQL InnoDB Cluster, SQL Server Always On

Это обеспечивает высокую доступность, а не просто резервное копирование.


### Задание 2. PostgreSQL
2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

Приведите ответ в свободной форме.

### Решение 2:

2.1. Команды резервирования и восстановления

Резервирование:
pg_dump -U username -F c -f /backup/db.dump mydb


Восстановление:
pg_restore -U username -d mydb /backup/db.dump

2.1. Автоматизация*
Да, возможно:

Cron-задание:
0 2 * * * pg_dump -U postgres -F c -f /backup/db_$(date +\%d).dump mydb

Скрипт с ротацией:
pg_dump -U postgres -F c -f /backup/db_$(date +%Y%m%d).dump mydb
find /backup -name "*.dump" -mtime +7 -delete

Специализированные утилиты: pgBackRest, Barman, WAL-G


### Задание 3. MySQL
3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

Приведите ответ в свободной форме.

### Решение 3:

3.1. Инкрементное резервное копирование в MySQL

Для инкрементного бэкапа требуется включить бинарное логирование:

Включение бинарных логов в my.cnf:
ini
[mysqld]
log-bin=mysql-bin
server-id=1

Создание полного бэкапа:
mysqldump -u root -p --flush-logs --master-data=2 --single-transaction --databases mydb > full_backup.sql
Создание инкрементного бэкапа:

mysqlbinlog mysql-bin.00000* > incremental_backup.sql

3.1. Преимущества реплики перед обычным бэкапом*

- Нулевая потеря данных - репликация в реальном времени

- Мгновенное переключение при сбое основной БД

- Распределение нагрузки - чтение можно направлять на реплику

- Бэкапы без нагрузки - делать с реплики, а не с основной БД

- Тестирование обновлений на реплике перед применением на продакшене

- Реплика решает задачи высокой доступности, а бэкап - восстановления после критических сбоев.
